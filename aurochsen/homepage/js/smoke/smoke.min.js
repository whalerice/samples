(function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?(module.exports=n(),module.exports.default=module.exports):e.smokemachine=e.SmokeMachine=n()})("undefined"!=typeof self?self:this,function(){function e(e,n){return e+Math.random()*(n-e)}function n(e){e=e||[24,46.8,48.2];for(var n=document.createElement("canvas"),t=n.getContext("2d"),a=t.createImageData(r,r),i=a.data,c=0;c<i.length;c+=4)i[c]=e[0],i[c+1]=e[1],i[c+2]=e[2],i[c+3]=o[c/4];return n.width=r,n.height=r,t.putImageData(a,0,0),n}function t(n,t,a){a=a||{};a.lifetime;var i={x:n,y:t,vx:e(a.minVx||-.04,a.maxVx||.04),startvy:e(a.minVy||-.4,a.maxVy||-.1),scale:e(a.minScale||0,a.maxScale||.5),lifetime:e(a.minLifetime||2e3,a.maxLifetime||8e3),age:0};return i.finalScale=e(a.minScale||25+i.scale,a.maxScale||30+i.scale),i.vy=i.startvy,i}function a(e,n){e.x+=e.vx*n,e.y+=e.vy*n;var t=Math.sqrt(e.age/e.lifetime);e.vy=(1-t)*e.startvy,e.age+=n,e.scale=t*e.finalScale}function i(e,n,t){t.globalAlpha=(1-Math.abs(1-2*e.age/e.lifetime))/8;var a=e.scale*r/2,i=e.x-a,o=i+2*a,c=e.y-a,f=c+2*a;t.drawImage(n,i,c,o-i,f-c)}var o=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,5,5,7,4,4,1,1,0,1,0,0,0,0,0,1,0,0,17,27,41,52,56,34,23,15,11,4,9,5,1,0,0,0,0,0,0,1,45,63,57,45,78,66,52,41,34,37,23,20,0,1,0,0,0,0,1,43,62,66,64,67,115,112,114,56,58,47,33,18,12,10,0,0,0,0,39,50,63,76,87,107,105,112,128,104,69,64,29,18,21,15,0,0,0,7,42,52,85,91,103,126,153,128,124,82,57,52,52,24,1,0,0,0,2,17,41,67,84,100,122,136,159,127,78,69,60,50,47,25,7,1,0,0,0,34,33,66,82,113,138,149,168,175,82,142,133,70,62,41,25,6,0,0,0,18,39,55,113,111,137,141,139,141,128,102,130,90,96,65,37,0,0,0,2,15,27,71,104,129,129,158,140,154,146,150,131,92,100,67,26,3,0,0,0,0,46,73,104,124,145,135,122,107,120,122,101,98,96,35,38,7,2,0,0,0,50,58,91,124,127,139,118,121,177,156,88,90,88,28,43,3,0,0,0,0,30,62,68,91,83,117,89,139,139,99,105,77,32,1,1,0,0,0,0,0,16,21,8,45,101,125,118,87,110,86,64,39,0,0,0,0,0,0,0,0,0,1,28,79,79,117,122,88,84,54,46,11,0,0,0,0,0,0,0,0,0,1,0,6,55,61,68,71,30,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,23,25,20,12,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,12,9,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,2,2,0,0,0,0,0,0,0,0],r=20,c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return function(e,o){function r(n){e.clearRect(0,0,e.canvas.width,e.canvas.height),l.forEach(function(e){a(e,n)}),l=l.filter(function(e){return e.age<e.lifetime}),s(n,l),l.forEach(function(n){i(n,u,e)})}function f(e){if(d){var n=e-h;h=e,r(n),c(f)}}function m(e,n,a,i){if(a=a||10,a<1)return Math.random()<=a&&l.push(t(e,n,i));for(var o=0;o<a;o++)l.push(t(e,n,i))}var u=n(o),l=[],s=function(){},d=!1,h=performance.now();return{step:function(e){e=e||16,console.log(e),r(e)},start:function(){d=!0,h=performance.now(),c(f)},setPreDrawCallback:function(e){s=e},stop:function(){d=!1},addsmoke:m,addSmoke:m}}});